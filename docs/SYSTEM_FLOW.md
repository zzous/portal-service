# í–‰íƒœê°ì§€ ì‹œìŠ¤í…œ ì „ì²´ íë¦„

## ğŸ“Š ì‹œìŠ¤í…œ ì•„í‚¤í…ì²˜

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                      ì‚¬ìš©ì ë¸Œë¼ìš°ì €                          â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                               â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”      â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                     â”‚
â”‚  â”‚ ABTestWrapper â”‚ â”€â”€â”€â”€â–¶â”‚BehaviorTrackerâ”‚                    â”‚
â”‚  â”‚ (ë²„ì „ í• ë‹¹)   â”‚      â”‚ (í–‰ë™ ì¶”ì )   â”‚                     â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜      â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”˜                     â”‚
â”‚                                â”‚                             â”‚
â”‚                                â–¼                             â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                    â”‚
â”‚  â”‚      FeedbackCollector               â”‚                    â”‚
â”‚  â”‚   (í”¼ë“œë°± ìˆ˜ì§‘ UI)                    â”‚                    â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                    â”‚
â”‚                                â”‚                             â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                                 â”‚
                    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                    â”‚            â”‚            â”‚
                    â–¼            â–¼            â–¼
        â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
        â”‚  Supabase    â”‚ â”‚ localStorage â”‚ â”‚ ë¡œì»¬ API     â”‚
        â”‚  (ìš°ì„ ìˆœìœ„1) â”‚ â”‚ (ë°±ì—…/í´ë°±)  â”‚ â”‚ (ê°œë°œí™˜ê²½)   â”‚
        â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                    â”‚            â”‚            â”‚
                    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                                 â”‚
                                 â–¼
                    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                    â”‚   Analysis Page      â”‚
                    â”‚   (ë°ì´í„° ë¶„ì„)      â”‚
                    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

## ğŸ”„ ìƒì„¸ íë¦„

### 1ë‹¨ê³„: ì´ˆê¸°í™” ë° ë²„ì „ í• ë‹¹

**íŒŒì¼**: `app/components/ABTestWrapper.tsx`

```
ì‚¬ìš©ì ì ‘ì†
    â”‚
    â–¼
ABTestWrapper ë§ˆìš´íŠ¸
    â”‚
    â”œâ”€â–¶ sessionStorageì—ì„œ ê¸°ì¡´ ë²„ì „ í™•ì¸
    â”‚   â””â”€â–¶ ìˆìœ¼ë©´: ê¸°ì¡´ ë²„ì „ ìœ ì§€ (ì¼ê´€ì„±)
    â”‚   â””â”€â–¶ ì—†ìœ¼ë©´: ëœë¤ í• ë‹¹ (A ë˜ëŠ” B)
    â”‚
    â–¼
BehaviorTracker ì´ˆê¸°í™”
    â”œâ”€â–¶ sessionId ìƒì„±
    â”œâ”€â–¶ variant ì €ì¥ (A ë˜ëŠ” B)
    â”œâ”€â–¶ ì´ë²¤íŠ¸ ë¦¬ìŠ¤ë„ˆ ë“±ë¡
    â”‚   â”œâ”€â–¶ click ì´ë²¤íŠ¸
    â”‚   â”œâ”€â–¶ scroll ì´ë²¤íŠ¸
    â”‚   â”œâ”€â–¶ mouseleave ì´ë²¤íŠ¸ (ì´íƒˆ ì˜ë„)
    â”‚   â””â”€â–¶ beforeunload ì´ë²¤íŠ¸
    â”‚
    â””â”€â–¶ ìë™ ì „ì†¡ íƒ€ì´ë¨¸ ì‹œì‘ (30ì´ˆë§ˆë‹¤)
```

### 2ë‹¨ê³„: í–‰ë™ ì¶”ì 

**íŒŒì¼**: `app/behavior/tracker.ts`

```
ì‚¬ìš©ì í–‰ë™ ë°œìƒ
    â”‚
    â”œâ”€â–¶ í´ë¦­ â†’ trackClick()
    â”œâ”€â–¶ ìŠ¤í¬ë¡¤ â†’ trackScroll()
    â”œâ”€â–¶ í˜ì´ì§€ë·° â†’ trackPageView()
    â”œâ”€â–¶ ì´íƒˆ ì˜ë„ â†’ trackExitIntent()
    â””â”€â–¶ ì „í™˜ ì´ë²¤íŠ¸ â†’ trackConversion()
    â”‚
    â–¼
ì´ë²¤íŠ¸ ë°°ì—´ì— ì €ì¥ (ë©”ëª¨ë¦¬)
    â”‚
    â”œâ”€â–¶ clickCount ì¦ê°€
    â”œâ”€â–¶ maxScrollDepth ì—…ë°ì´íŠ¸
    â””â”€â–¶ pagesVisited ì¶”ê°€
    â”‚
    â–¼
ì£¼ê¸°ì  ë˜ëŠ” í˜ì´ì§€ ì–¸ë¡œë“œ ì‹œ
    â”‚
    â””â”€â–¶ sendBehaviorData() í˜¸ì¶œ
```

### 3ë‹¨ê³„: ë°ì´í„° ì €ì¥ (ë‹¤ì¤‘ ì €ì¥ì†Œ ì „ëµ)

**íŒŒì¼**: `app/behavior/tracker.ts` â†’ `sendBehaviorData()`

```
sendBehaviorData() ì‹¤í–‰
    â”‚
    â”œâ”€â–¶ 1. localStorage ì €ì¥ (í•­ìƒ)
    â”‚   â””â”€â–¶ ClientStorage.saveBehavior()
    â”‚   â””â”€â–¶ ë¸Œë¼ìš°ì €ì— ì˜êµ¬ ì €ì¥ (ë°±ì—…)
    â”‚
    â”œâ”€â–¶ 2. Supabase ì €ì¥ ì‹œë„ (í™˜ê²½ ë³€ìˆ˜ ìˆìœ¼ë©´)
    â”‚   â””â”€â–¶ saveBehaviorToSupabase()
    â”‚   â””â”€â–¶ ì„±ê³µ ì‹œ: supabaseSaved = true
    â”‚   â””â”€â–¶ ì‹¤íŒ¨ ì‹œ: supabaseSaved = false
    â”‚
    â””â”€â–¶ 3. ë¡œì»¬ API í˜¸ì¶œ (Supabase ì‹¤íŒ¨ ì‹œë§Œ)
        â””â”€â–¶ POST /api/behavior
        â””â”€â–¶ ê°œë°œ í™˜ê²½ì—ì„œë§Œ ì‘ë™
```

**ì €ì¥ ìš°ì„ ìˆœìœ„**:
1. âœ… **Supabase** (í”„ë¡œë•ì…˜, ì˜êµ¬ ì €ì¥)
2. âœ… **localStorage** (í•­ìƒ, í´ë¼ì´ì–¸íŠ¸ ë°±ì—…)
3. âœ… **ë¡œì»¬ API** (ê°œë°œ í™˜ê²½, Supabase ì—†ì„ ë•Œë§Œ)

### 4ë‹¨ê³„: í”¼ë“œë°± íŠ¸ë¦¬ê±° í™•ì¸

**íŒŒì¼**: `app/components/FeedbackCollector.tsx` + `app/behavior/feedback-manager.ts`

```
í–‰ë™ ë°ì´í„° ì „ì†¡ í›„
    â”‚
    â–¼
FeedbackManager.checkFeedbackTriggers()
    â”‚
    â”œâ”€â–¶ ì²´ë¥˜ ì‹œê°„ 30ì´ˆ ì´ìƒ?
    â”œâ”€â–¶ ìŠ¤í¬ë¡¤ ê¹Šì´ 50% ì´ìƒ?
    â”œâ”€â–¶ í´ë¦­ ìˆ˜ 5íšŒ ì´ìƒ?
    â”œâ”€â–¶ ì´íƒˆ ì˜ë„ ê°ì§€?
    â””â”€â–¶ ì „í™˜ ì´ë²¤íŠ¸ ë°œìƒ?
    â”‚
    â”œâ”€â–¶ ì¡°ê±´ ì¶©ì¡± ì‹œ
    â”‚   â””â”€â–¶ í”¼ë“œë°± ëª¨ë‹¬ í‘œì‹œ
    â”‚   â””â”€â–¶ ì‚¬ìš©ì ì…ë ¥ ëŒ€ê¸°
    â”‚
    â””â”€â–¶ ì¡°ê±´ ë¯¸ì¶©ì¡± ì‹œ
        â””â”€â–¶ í”¼ë“œë°± ìš”ì²­ ì•ˆ í•¨
```

### 5ë‹¨ê³„: í”¼ë“œë°± ìˆ˜ì§‘ ë° ì €ì¥

**íŒŒì¼**: `app/behavior/feedback-manager.ts` â†’ `collectFeedback()`

```
ì‚¬ìš©ìê°€ í”¼ë“œë°± ì œì¶œ
    â”‚
    â–¼
collectFeedback() ì‹¤í–‰
    â”‚
    â”œâ”€â–¶ 1. localStorage ì €ì¥ (í•­ìƒ)
    â”‚   â””â”€â–¶ ClientStorage.saveFeedback()
    â”‚
    â”œâ”€â–¶ 2. Supabase ì €ì¥ ì‹œë„
    â”‚   â””â”€â–¶ saveFeedbackToSupabase()
    â”‚   â””â”€â–¶ ì„±ê³µ ì‹œ: supabaseSaved = true
    â”‚
    â””â”€â–¶ 3. ë¡œì»¬ API í˜¸ì¶œ (Supabase ì‹¤íŒ¨ ì‹œë§Œ)
        â””â”€â–¶ POST /api/feedback
```

### 6ë‹¨ê³„: ë°ì´í„° ë¶„ì„

**íŒŒì¼**: `app/analysis/page.tsx`

```
ë¶„ì„ í˜ì´ì§€ ì ‘ì†
    â”‚
    â–¼
fetchAnalysis() ì‹¤í–‰
    â”‚
    â”œâ”€â–¶ 1. Supabaseì—ì„œ ì§ì ‘ ì¡°íšŒ
    â”‚   â”œâ”€â–¶ getBehaviorsFromSupabase('A')
    â”‚   â”œâ”€â–¶ getBehaviorsFromSupabase('B')
    â”‚   â”œâ”€â–¶ getFeedbacksFromSupabase('A')
    â”‚   â””â”€â–¶ getFeedbacksFromSupabase('B')
    â”‚
    â”œâ”€â–¶ 2. localStorageì—ì„œ ì¡°íšŒ
    â”‚   â”œâ”€â–¶ ClientStorage.getBehaviorsByVariant('A')
    â”‚   â””â”€â–¶ ClientStorage.getFeedbacksByVariant('A')
    â”‚
    â”œâ”€â–¶ 3. ë°ì´í„° ë³‘í•© (Supabase ìš°ì„ )
    â”‚
    â”œâ”€â–¶ 4. APIì—ì„œ ì¡°íšŒ (ì„œë²„ ì¸¡ ë°ì´í„°)
    â”‚   â””â”€â–¶ GET /api/feedback/analysis?variant=A
    â”‚   â””â”€â–¶ GET /api/feedback/analysis?variant=B
    â”‚
    â””â”€â–¶ 5. ë¶„ì„ ê²°ê³¼ ê³„ì‚°
        â”œâ”€â–¶ í‰ê·  í‰ì 
        â”œâ”€â–¶ í‰ê·  ì²´ë¥˜ ì‹œê°„
        â”œâ”€â–¶ ì „í™˜ìœ¨
        â”œâ”€â–¶ ì°¸ì—¬ë„ ì ìˆ˜
        â””â”€â–¶ ì´ ì„¸ì…˜ ìˆ˜
```

## ğŸ“ ì£¼ìš” íŒŒì¼ ì—­í• 

### í´ë¼ì´ì–¸íŠ¸ ì‚¬ì´ë“œ

| íŒŒì¼ | ì—­í•  |
|------|------|
| `ABTestWrapper.tsx` | A/B í…ŒìŠ¤íŠ¸ ë²„ì „ í• ë‹¹ ë° íŠ¸ë˜ì»¤ ì´ˆê¸°í™” |
| `BehaviorTracker` | ì‚¬ìš©ì í–‰ë™ ì¶”ì  (í´ë¦­, ìŠ¤í¬ë¡¤, í˜ì´ì§€ë·° ë“±) |
| `FeedbackCollector` | í”¼ë“œë°± ìˆ˜ì§‘ UI ì»´í¬ë„ŒíŠ¸ |
| `FeedbackManager` | í”¼ë“œë°± íŠ¸ë¦¬ê±° í™•ì¸ ë° ìˆ˜ì§‘ ë¡œì§ |
| `client-storage.ts` | localStorage ì½ê¸°/ì“°ê¸° ìœ í‹¸ë¦¬í‹° |
| `supabase-client.ts` | Supabase í´ë¼ì´ì–¸íŠ¸ ì´ˆê¸°í™” |
| `supabase-storage.ts` | Supabase ì €ì¥/ì¡°íšŒ í•¨ìˆ˜ |

### ì„œë²„ ì‚¬ì´ë“œ (API)

| íŒŒì¼ | ì—­í•  |
|------|------|
| `app/api/behavior/route.ts` | í–‰ë™ ë°ì´í„° ìˆ˜ì‹  ë° ì €ì¥ |
| `app/api/feedback/route.ts` | í”¼ë“œë°± ë°ì´í„° ìˆ˜ì‹  ë° ì €ì¥ |
| `app/api/feedback/analysis/route.ts` | A/B í…ŒìŠ¤íŠ¸ ë¶„ì„ ê²°ê³¼ ì œê³µ |
| `supabase-server.ts` | Supabase ì„œë²„ ì‚¬ì´ë“œ í´ë¼ì´ì–¸íŠ¸ |

### í˜ì´ì§€

| íŒŒì¼ | ì—­í•  |
|------|------|
| `app/demo/page.tsx` | A/B í…ŒìŠ¤íŠ¸ ë°ëª¨ í˜ì´ì§€ |
| `app/analysis/page.tsx` | ë¶„ì„ ê²°ê³¼ í‘œì‹œ í˜ì´ì§€ |
| `app/report/page.tsx` | ì‹œìŠ¤í…œ êµ¬í˜„ ë¦¬í¬íŠ¸ í˜ì´ì§€ |

## ğŸ” ë°ì´í„° ì €ì¥ ì „ëµ

### í´ë°± ë©”ì»¤ë‹ˆì¦˜

```
Supabase ì €ì¥ ì‹œë„
    â”‚
    â”œâ”€â–¶ ì„±ê³µ â†’ Supabaseì— ì €ì¥ âœ…
    â”‚   â””â”€â–¶ ë¡œì»¬ API í˜¸ì¶œ ì•ˆ í•¨ (ì¤‘ë³µ ë°©ì§€)
    â”‚
    â””â”€â–¶ ì‹¤íŒ¨ â†’ ë¡œì»¬ API í˜¸ì¶œ ì‹œë„
        â”‚
        â”œâ”€â–¶ ì„±ê³µ â†’ ë¡œì»¬ APIì— ì €ì¥ âœ…
        â”‚
        â””â”€â–¶ ì‹¤íŒ¨ â†’ localStorageë§Œ ì‚¬ìš© âœ…
```

### ì €ì¥ì†Œë³„ íŠ¹ì§•

| ì €ì¥ì†Œ | ìš©ë„ | ì§€ì†ì„± | ì ‘ê·¼ì„± |
|--------|------|--------|--------|
| **Supabase** | í”„ë¡œë•ì…˜ ë°ì´í„° | ì˜êµ¬ | ëª¨ë“  í´ë¼ì´ì–¸íŠ¸ ê³µìœ  |
| **localStorage** | ë°±ì—…/í´ë°± | ë¸Œë¼ìš°ì €ë³„ | í´ë¼ì´ì–¸íŠ¸ë³„ |
| **ë¡œì»¬ API** | ê°œë°œ í™˜ê²½ | ì„œë²„ ì¬ì‹œì‘ ì‹œ ì´ˆê¸°í™” | ê°œë°œ í™˜ê²½ë§Œ |

## ğŸ¯ ì£¼ìš” ì´ë²¤íŠ¸ íƒ€ì…

1. **click**: ì‚¬ìš©ì í´ë¦­ (ì¢Œí‘œ í¬í•¨)
2. **scroll**: ìŠ¤í¬ë¡¤ ê¹Šì´ (0-100%)
3. **view**: í˜ì´ì§€ë·° (ì œëª©, ì„¤ëª… í¬í•¨)
4. **exit**: ì´íƒˆ ì˜ë„ (ë§ˆìš°ìŠ¤ê°€ ìƒë‹¨ìœ¼ë¡œ ì´ë™)
5. **conversion**: ì „í™˜ ì´ë²¤íŠ¸ (ëª©í‘œ ë‹¬ì„±)

## ğŸ“ˆ ë¶„ì„ ì§€í‘œ

- **í‰ê·  í‰ì **: í”¼ë“œë°± í‰ì ì˜ í‰ê· 
- **í‰ê·  ì²´ë¥˜ ì‹œê°„**: í˜ì´ì§€ ì²´ë¥˜ ì‹œê°„ì˜ í‰ê· 
- **ì „í™˜ìœ¨**: ì „í™˜ ì´ë²¤íŠ¸ ë°œìƒ ë¹„ìœ¨
- **ì°¸ì—¬ë„ ì ìˆ˜**: (í´ë¦­ ìˆ˜ Ã— 10) + ìŠ¤í¬ë¡¤ ê¹Šì´
- **ì´ ì„¸ì…˜ ìˆ˜**: ë²„ì „ë³„ ì´ ì„¸ì…˜ ìˆ˜
- **í”¼ë“œë°± ìˆ˜**: ë²„ì „ë³„ í”¼ë“œë°± ìˆ˜ì§‘ ìˆ˜

## ğŸ”„ ì‹¤ì‹œê°„ ë°ì´í„° íë¦„

```
ì‚¬ìš©ì í–‰ë™
    â†“
BehaviorTracker (ë©”ëª¨ë¦¬)
    â†“ (30ì´ˆë§ˆë‹¤ ë˜ëŠ” í˜ì´ì§€ ì–¸ë¡œë“œ ì‹œ)
sendBehaviorData()
    â”œâ”€â–¶ localStorage (ì¦‰ì‹œ)
    â”œâ”€â–¶ Supabase (ë¹„ë™ê¸°)
    â””â”€â–¶ ë¡œì»¬ API (Supabase ì‹¤íŒ¨ ì‹œ)
    â†“
ë¶„ì„ í˜ì´ì§€
    â”œâ”€â–¶ Supabase ì¡°íšŒ
    â”œâ”€â–¶ localStorage ì¡°íšŒ
    â””â”€â–¶ API ì¡°íšŒ
    â†“
ë°ì´í„° ë³‘í•© ë° ë¶„ì„ ê²°ê³¼ í‘œì‹œ
```

## ğŸ›¡ï¸ ì—ëŸ¬ ì²˜ë¦¬

- **Supabase ì‹¤íŒ¨**: ì¡°ìš©íˆ ì²˜ë¦¬, localStorageì™€ ë¡œì»¬ APIë¡œ í´ë°±
- **ë¡œì»¬ API ì‹¤íŒ¨**: ì¡°ìš©íˆ ì²˜ë¦¬, localStorageë§Œ ì‚¬ìš©
- **ë„¤íŠ¸ì›Œí¬ ì˜¤ë¥˜**: localStorageì— ì €ì¥, ë‚˜ì¤‘ì— ì¬ì‹œë„ ê°€ëŠ¥
- **ì •ì  ì‚¬ì´íŠ¸ í™˜ê²½**: localStorageë§Œ ì‚¬ìš© (GitHub Pages ë“±)

## ğŸ’¡ ìµœì í™” í¬ì¸íŠ¸

1. **ë°°ì¹˜ ì „ì†¡**: 30ì´ˆë§ˆë‹¤ ë˜ëŠ” í˜ì´ì§€ ì–¸ë¡œë“œ ì‹œ í•œ ë²ˆì— ì „ì†¡
2. **ì¤‘ë³µ ë°©ì§€**: `isSending` í”Œë˜ê·¸ë¡œ ì¤‘ë³µ ì „ì†¡ ë°©ì§€
3. **ìš°ì„ ìˆœìœ„**: Supabase â†’ ë¡œì»¬ API â†’ localStorage
4. **ë°ì´í„° ë³‘í•©**: ì—¬ëŸ¬ ì†ŒìŠ¤ì—ì„œ ë°ì´í„°ë¥¼ ë³‘í•©í•˜ì—¬ ì™„ì „í•œ ë¶„ì„ ì œê³µ

