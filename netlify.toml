[build]
  command = "pnpm install && pnpm run build"
  publish = "out"

[build.environment]
  NODE_VERSION = "20"
  NODE_ENV = "production"
  # Netlify는 basePath를 사용하지 않으므로 GITHUB_PAGES를 설정하지 않음
  # pnpm 사용
  PNPM_VERSION = "10"

# Netlify Functions 설정
[functions]
  node_bundler = "esbuild"

# SPA 라우팅 (모든 다른 경로는 index.html로, API 제외)
# API 라우트는 Functions로 리다이렉트 (더 구체적인 경로를 먼저)
[[redirects]]
  from = "/api/behavior"
  to = "/.netlify/functions/api-behavior"
  status = 200
  force = true

[[redirects]]
  from = "/api/feedback/analysis"
  to = "/.netlify/functions/api-feedback-analysis"
  status = 200
  force = true

[[redirects]]
  from = "/api/feedback"
  to = "/.netlify/functions/api-feedback"
  status = 200
  force = true

# SPA 라우팅 (API를 제외한 모든 경로는 index.html로)
[[redirects]]
  from = "/*"
  to = "/index.html"
  status = 200

